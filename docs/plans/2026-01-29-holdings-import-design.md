# 持仓截图导入功能设计

## 概述

在自选股页面增加「自选」「持仓」两个子tab，用户可以通过截图OCR识别东方财富持仓，一键导入到持仓列表。

## 背景

- 东方财富手机App没有导出持仓功能
- 用户希望在盯喵App中追踪自己的持仓股票
- 截图OCR是最便捷的导入方式

## 核心特性

### 1. 子Tab结构

自选股页面（WatchlistScreen）顶部增加 TabBar：
- 「自选」：现有的自选股列表，功能不变
- 「持仓」：新增的持仓追踪列表

两个列表复用同一个 StockListView 组件，显示相同的行情数据（量比、涨跌幅、最新价等）。

### 2. 截图OCR识别

识别流程：
1. 用户点击持仓tab右上角的导入按钮
2. 选择截图（从相册或拍照）
3. Google ML Kit 离线识别文字
4. 正则提取6位数字（`\d{6}`）
5. 校验有效A股代码（60/00/30/68开头）
6. 展示识别结果供用户确认
7. 确认后导入

### 3. 替换模式

每次导入完全覆盖旧持仓列表，与实际持仓保持一致。

### 4. 用户确认

识别完成后显示确认页面：
- 列出识别到的股票（代码 + 名称）
- 用户可以取消勾选误识别的股票
- 提供「手动添加」入口
- 确认按钮：「导入 X 只股票」

## 技术方案

### 依赖

```yaml
dependencies:
  google_mlkit_text_recognition: ^0.14.0
  image_picker: ^1.0.7
```

### 数据存储

使用 SharedPreferences，与自选股独立存储：
- 自选股：key = `watchlist`
- 持仓：key = `holdings`

数据结构：股票代码列表
```dart
List<String> holdings = ["600519", "000001", "300750"];
```

### 代码结构

```
lib/
├── services/
│   ├── holdings_service.dart      # 持仓数据管理
│   └── ocr_service.dart           # 截图识别逻辑
├── screens/
│   └── watchlist_screen.dart      # 改造：加入TabBar
└── widgets/
    └── holdings_confirm_dialog.dart  # 识别确认页面
```

### 股票代码校验规则

有效的A股代码前缀：
- `60xxxx`：沪市主板
- `00xxxx`：深市主板
- `30xxxx`：创业板
- `68xxxx`：科创板

## UI设计

### 自选股页面改造

```
┌─────────────────────────────────┐
│  [自选]  [持仓]          [...]  │  <- TabBar + 菜单
├─────────────────────────────────┤
│                                 │
│  股票列表（复用 StockListView） │
│                                 │
└─────────────────────────────────┘
```

### 持仓Tab空状态

```
┌─────────────────────────────────┐
│                                 │
│      📷                         │
│   从东方财富截图导入持仓        │
│                                 │
│     [选择截图]                  │
│                                 │
└─────────────────────────────────┘
```

### 识别确认页面

```
┌─────────────────────────────────┐
│  识别结果                    ✕  │
├─────────────────────────────────┤
│  ☑ 600519 贵州茅台             │
│  ☑ 000001 平安银行             │
│  ☑ 300750 宁德时代             │
│  ☐ 123456 (无效代码)           │
├─────────────────────────────────┤
│  + 手动添加                     │
├─────────────────────────────────┤
│     [导入 3 只股票]             │
└─────────────────────────────────┘
```

## 实现步骤

1. 添加依赖 `google_mlkit_text_recognition` 和 `image_picker`
2. 创建 HoldingsService（持仓数据管理）
3. 创建 OcrService（截图识别逻辑）
4. 改造 WatchlistScreen（添加 TabBar）
5. 创建持仓列表视图
6. 创建识别确认页面
7. 集成测试

## 风险与应对

| 风险 | 应对措施 |
|------|----------|
| OCR识别不准确 | 代码校验 + 用户确认步骤 |
| 截图格式不一致 | 只提取6位数字，不依赖布局 |
| ML Kit包体积 | 约增加几MB，可接受 |
